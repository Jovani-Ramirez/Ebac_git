<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/63269cb503.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <header class="d-flex justify-content-between align-items-center py-3 border-bottom">
            <h1 class="h3">Carrito de Compras</h1>
            <a href="index.html" class="btn btn-outline-primary">Volver a la tienda</a>
        </header>

        <main>
            <section>
                <h2 class="text-center">Tu Carrito</h2>
                <ul class="list-group mt-4" id="cart-items">
                    <!-- Los productos serán añadidos aquí dinámicamente -->
                </ul>
                <div class="text-end mt-3">
                    <h4>Total: <span id="total-price">$0.00</span></h4>
                    <button class="btn btn-success mt-2">Finalizar Compra</button>
                </div>
            </section>
        </main>

        <footer class="text-center py-4 mt-4 border-top">
            <p>&copy; 2025 Jurassic World Souvenirs</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Recuperar el carrito del localStorage
        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        // Función para eliminar un producto del carrito
        function removeFromCart(index) {
            cart.splice(index, 1); // Elimina el producto en el índice especificado
            localStorage.setItem("cart", JSON.stringify(cart)); // Actualiza el localStorage
            renderCart(); // Vuelve a renderizar el carrito
        }

        // Función para renderizar los productos en el carrito
        function renderCart() {
            const cartItemsContainer = document.getElementById("cart-items");
            cartItemsContainer.innerHTML = ''; // Limpiar la lista de productos
            let totalPrice = 0;

            // Agrupar productos por nombre
            const groupedProducts = cart.reduce((acc, product) => {
                const existingProduct = acc.find(p => p.title === product.title);
                if (existingProduct) {
                    existingProduct.quantity += 1; // Incrementar cantidad si ya existe el producto
                    existingProduct.totalPrice += parseFloat(product.price.slice(1)); // Sumar el precio
                } else {
                    acc.push({
                        ...product,
                        quantity: 1,
                        totalPrice: parseFloat(product.price.slice(1)) // Inicializar precio acumulado
                    });
                }
                return acc;
            }, []);

            // Renderizar los productos agrupados
            groupedProducts.forEach((product, index) => {
                const li = document.createElement("li");
                li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");
                li.innerHTML = `
                    <div class="d-flex align-items-center">
                        <img src="${product.img}" alt="${product.title}" style="width: 50px; height: 50px; margin-right: 10px;">
                        <span>${product.title} (x${product.quantity})</span>
                    </div>
                    <span>$${product.totalPrice.toFixed(2)}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Eliminar</button>
                `;
                cartItemsContainer.appendChild(li);
                totalPrice += product.totalPrice;
            });

            // Actualizar el total
            document.getElementById("total-price").textContent = `$${totalPrice.toFixed(2)}`;
        }

        // Llamar a la función para renderizar el carrito al cargar la página
        renderCart();
    </script>
</body>

</html>
